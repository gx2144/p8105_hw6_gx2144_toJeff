---
title: "homework6"
author: "Guangling Xu"
date: "2019/11/24"
output: github_document
---
---
```{r}
library(tidyverse)
knitr::opts_chunk$set(
    echo = TRUE,
    warning = FALSE,
    fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

### Data Cleaning

```{r}
birthweight =
  read_csv("./data/birthweight.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    babysex = factor(babysex, labels = c("male", "female")),
    frace  = factor(frace, labels = c("White","Black","Asian","Puerto Rican","Other")),
    malform = factor(malform, labels = c("absent","present")),
    mrace = factor(mrace, labels = c("White","Black","Asian","Puerto Rican")),
    babysex = fct_infreq(babysex),
    frace = fct_infreq(frace),
    malform=  fct_infreq(malform),
    mrace = fct_infreq(mrace)
     )
```




### Model Building

First we hypothesize that birthweight was affected by all the predcitors given by the dataset.

```{r}
reg_lbt_m = lm(bwt ~ babysex + bhead + blength + delwt + fincome + frace + gaweeks + menarche + momage + mheight + mrace + parity + pnumlbw + pnumsga + ppbmi + ppwt + smoken + wtgain, data = birthweight)  

summary(reg_lbt_m)
```

Then we drop out those whose `p.value` is larger than 0.05 and refit the model.

```{r}
reg_lbt_m_sex = lm(bwt~ babysex + bhead + blength + delwt + gaweeks + parity + smoken, data = birthweight)
broom::tidy(reg_lbt_m_sex) %>% 
  select(term, estimate, p.value) %>% 
  knitr::kable()
```

The table shows that all the predictors now cnotribute to the fitted model due to small `p.value`.

There for the model we set on the factors underying birthweight is 
`birthweight ~ babysex + bhead + blength + delwt + gaweeks + parity + smoken`.


### Diagnositic

Then we diagonise whether the linear model fit.

```{r}
resplot_mrace= birthweight %>% 
  modelr::add_residuals(reg_lbt_m_sex) %>% 
  modelr::add_predictions(reg_lbt_m_sex) %>%
  ggplot(aes(x = pred, y = resid)) + geom_point()+
  geom_line( y = 0, color = "red")+
  labs(
    title = "Model Residuals against Fitted Values",
    x = "Fitted values",
    y = "Residuals"
  )
resplot_mrace

```

From the plot above,we can see that most of the fitted values lie between 2000-4000 and most of the residuals are randomly lie around zero, indicating linearity . 